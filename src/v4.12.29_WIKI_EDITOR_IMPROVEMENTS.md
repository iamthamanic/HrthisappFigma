# v4.12.29 - Wiki Rich Text Editor Verbesserungen

**Datum:** 3. November 2025  
**Status:** ‚úÖ COMPLETE  
**Komponente:** `BrowoKo_RichTextEditor.tsx`

---

## üéØ Implementierte Features

### 1. ‚úÖ Word-√§hnliche Schriftgr√∂√üen
- **Vorher:** Nur 4 abstrakte Gr√∂√üen (Klein, Normal, Gro√ü, Sehr gro√ü) mit HTML-Werten 1-7
- **Jetzt:** 12 pr√§zise Pixel-Gr√∂√üen wie in Microsoft Word:
  - 10px, 12px, 14px, 16px, 18px, 20px
  - 24px, 28px, 32px, 36px, 48px, 72px
- **Implementierung:** Custom `applyFontSize()` Funktion die `<span style="font-size: XXpx">` verwendet
- **UX:** Dropdown zeigt jede Gr√∂√üe in ihrer tats√§chlichen Schriftgr√∂√üe als Preview

### 2. ‚úÖ Bild Einf√ºgen Button funktioniert
- **Problem behoben:** Dialog √∂ffnet sich jetzt korrekt √ºber dem Wiki-Modal
- **Features:**
  - Bild hochladen direkt zu Supabase Storage (`wiki-images` Bucket)
  - Oder Bild-URL eingeben
  - Unterst√ºtzt: JPG, PNG, GIF, WebP (max. 5MB)
  - Responsive Bilder mit max-width: 100%
- **z-index:** Dialog Overlay z-[240], Content z-[250]

### 3. ‚úÖ Hyperlink Button funktioniert
- **Problem behoben:** Dialog √∂ffnet sich jetzt korrekt √ºber dem Wiki-Modal
- **Features:**
  - URL eingeben (Pflichtfeld)
  - Optional: Link-Text eingeben
  - Wenn kein Text: Verwendet markierten Text
  - Links √∂ffnen in neuem Tab (target="_blank")
- **z-index:** Dialog Overlay z-[240], Content z-[250]

---

## üîß Technische Details

### Font Size Implementation
```typescript
const applyFontSize = (size: string) => {
  const selection = window.getSelection();
  if (!selection || selection.rangeCount === 0) return;

  const range = selection.getRangeAt(0);
  const selectedText = range.toString();

  if (selectedText) {
    const span = document.createElement('span');
    span.style.fontSize = size;
    
    range.deleteContents();
    span.textContent = selectedText;
    range.insertNode(span);
  }
};
```

### Dialog z-index Hierarchie
```
Toolbar Popovers (Farbe, Schriftgr√∂√üe): z-[220]
  ‚Üì
Wiki Edit Dialog: z-[200]
  ‚Üì
Editor Dialog Overlay (Bild/Link): z-[240]
  ‚Üì
Editor Dialog Content (Bild/Link): z-[250]
```

### DialogPortal Struktur
```tsx
<Dialog open={imageDialogOpen} onOpenChange={setImageDialogOpen}>
  <DialogPortal>
    <DialogOverlay className="z-[240]" />
    <DialogContent className="sm:max-w-md z-[250]">
      {/* Content */}
    </DialogContent>
  </DialogPortal>
</Dialog>
```

---

## üìù Font Sizes Array
```typescript
const fontSizes = [
  { label: '10', value: '10px' },
  { label: '12', value: '12px' },
  { label: '14', value: '14px' },
  { label: '16', value: '16px' },
  { label: '18', value: '18px' },
  { label: '20', value: '20px' },
  { label: '24', value: '24px' },
  { label: '28', value: '28px' },
  { label: '32', value: '32px' },
  { label: '36', value: '36px' },
  { label: '48', value: '48px' },
  { label: '72', value: '72px' },
];
```

---

## ‚úÖ Testing Checklist

- [x] Schriftgr√∂√üe auf markierten Text anwenden funktioniert
- [x] Dropdown zeigt alle 12 Gr√∂√üen an
- [x] Preview in Dropdown zeigt korrekte Gr√∂√üe
- [x] Bild-Dialog √∂ffnet sich √ºber Wiki-Modal
- [x] Bild hochladen zu Supabase funktioniert
- [x] Bild per URL einf√ºgen funktioniert
- [x] Link-Dialog √∂ffnet sich √ºber Wiki-Modal
- [x] Link mit markiertem Text funktioniert
- [x] Link mit eigenem Text funktioniert
- [x] Alle z-index korrekt (keine √úberlappungen)

---

## üé® UX Verbesserungen

1. **Font Size Dropdown:**
   - Scrollbar bei vielen Optionen (max-h-[400px])
   - Jede Option zeigt ihre eigene Schriftgr√∂√üe
   - Hover-Effekt f√ºr bessere Sichtbarkeit

2. **Bild Dialog:**
   - Klare Trennung: Upload ODER URL
   - Upload-Button mit Loading-State
   - Dateiformat-Hinweis
   - Abbrechen-Button

3. **Link Dialog:**
   - Enter-Taste zum Best√§tigen
   - Validierung: URL ist Pflichtfeld
   - Hilfetext f√ºr Link-Text Feld
   - Disabled-State wenn keine URL

---

## üîÑ Migration Notes

**KEINE MIGRATION NOTWENDIG**
- Komponente ist drop-in replacement
- Bestehende Wiki-Artikel bleiben unver√§ndert
- Alte Font-Size Werte werden korrekt dargestellt

---

## üì¶ Files Changed

```
components/
  ‚îî‚îÄ‚îÄ BrowoKo_RichTextEditor.tsx  [UPDATED]
```

**Version:** 4.12.24 ‚Üí 4.12.29

---

## üöÄ Next Steps

Alle gew√ºnschten Features sind implementiert! Der Editor ist jetzt production-ready mit:
- ‚úÖ Word-√§hnliche Schriftgr√∂√üen
- ‚úÖ Funktionierende Bild-Einf√ºgen Funktion
- ‚úÖ Funktionierende Link-Einf√ºgen Funktion
