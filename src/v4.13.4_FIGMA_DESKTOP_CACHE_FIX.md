# âš¡ v4.13.4: FIGMA DESKTOP CACHE FIX

**Problem:** Videos zeigen immer noch "(bereits zugewiesen)" nach SQL DELETE!

**Grund:** Figma Desktop hat **eigenen Browser-Cache!**

---

## ğŸ” **SCHRITT 1: SQL VERIFY (30 Sekunden)**

**FÃ¼hre dieses SQL in Supabase aus:**

```sql
SELECT COUNT(*) as assignments FROM test_video_assignments;
SELECT COUNT(*) as tests FROM tests;
```

**Erwartetes Ergebnis:**
```
assignments: 0
tests: 0
```

**Falls NICHT 0:**

```sql
-- Nochmal lÃ¶schen!
DELETE FROM test_video_assignments;
DELETE FROM tests WHERE organization_id = '60f2a9c9-dc19-4edc-9491-900819649b4a';

-- Verify:
SELECT COUNT(*) FROM test_video_assignments;
```

---

## ğŸ”„ **SCHRITT 2: FIGMA DESKTOP CACHE LEEREN**

### **OPTION A: DevTools Hard Refresh (SCHNELLSTE)**

1. âœ… **F12 drÃ¼cken** (DevTools Ã¶ffnen)
2. âœ… **Rechtsklick** auf Reload-Button (oben links)
3. âœ… **"Leeren Cache und harte Neuladung"** wÃ¤hlen

![DevTools Hard Refresh](https://i.imgur.com/xxx.png)

---

### **OPTION B: Figma Desktop Neustart**

**Windows:**
1. Figma Desktop schlieÃŸen (ALT + F4)
2. Figma Desktop neu starten
3. Make-App Ã¶ffnen

**Mac:**
1. Figma Desktop beenden (CMD + Q)
2. Figma Desktop neu starten
3. Make-App Ã¶ffnen

---

### **OPTION C: Supabase Client Reset (IM FRONTEND)**

**Falls DevTools offen ist:**

```javascript
// In Console eingeben:
localStorage.clear();
sessionStorage.clear();
location.reload(true);
```

---

## ğŸ§ª **SCHRITT 3: TEST**

**Nach Cache-Leerung:**

1. âœ… **Admin** â†’ **Lernen** â†’ **Tests** Tab
2. âœ… **"Test erstellen"** klicken
3. âœ… **F12** â†’ **Console** Tab Ã¶ffnen
4. âœ… **Video Dropdown** Ã¶ffnen

**Schau dir diese Logs an:**

```javascript
ğŸ” [CreateTestDialog] Assignments data: ???
âœ… [CreateTestDialog] Assigned video IDs: ???
ğŸ¬ [CreateTestDialog] Video: xxx assigned: ???
```

---

## âœ… **ERWARTETES ERGEBNIS:**

### **Console Logs:**
```
ğŸ” [CreateTestDialog] Assignment query result: { assignments: [], assignError: null }
ğŸ” [CreateTestDialog] Assignments data: []
âœ… [CreateTestDialog] Assigned video IDs (with existing tests): 0
âœ… [CreateTestDialog] Assigned videos: []
ğŸ¬ [CreateTestDialog] Rendering videos: Array(7)
ğŸ¬ [CreateTestDialog] Video: 63eb50ae... Arbeitssicherheit assigned: false
ğŸ¬ [CreateTestDialog] Video: fc055900... Kommunikation assigned: false
```

### **Video Dropdown:**
```
âœ… Kein Video
âœ… ğŸ“¹ Arbeitssicherheit          â† WÃ¤hlbar!
âœ… ğŸ“¹ Kommunikations-Skills      â† WÃ¤hlbar!
âœ… ğŸ“¹ Excel Grundlagen           â† WÃ¤hlbar!
```

**NICHT:**
```
âŒ ğŸ“¹ Arbeitssicherheit  (bereits zugewiesen)
```

---

## ğŸš¨ **TROUBLESHOOTING:**

### **Problem: Immer noch "bereits zugewiesen"**

**PrÃ¼fe:**

1ï¸âƒ£ **SQL wirklich durchgelaufen?**
```sql
SELECT COUNT(*) FROM test_video_assignments;
-- Muss 0 sein!
```

2ï¸âƒ£ **Cache wirklich geleert?**
- DevTools â†’ Application â†’ Clear Storage â†’ Clear Site Data

3ï¸âƒ£ **Console Logs zeigen alte Daten?**
```javascript
// Wenn Logs zeigen:
âœ… [CreateTestDialog] Assigned video IDs: 4  // â† PROBLEM!

// Dann ist Cache NICHT geleert!
```

---

## ğŸ“‹ **QUICK CHECKLIST:**

- [ ] SQL ausgefÃ¼hrt: `DELETE FROM test_video_assignments;`
- [ ] SQL Verify: `SELECT COUNT(*) FROM test_video_assignments;` â†’ 0
- [ ] DevTools Hard Refresh: F12 â†’ Rechtsklick Reload â†’ Hard Refresh
- [ ] ODER: Figma Desktop Neustart
- [ ] Dialog Ã¶ffnen & Video Dropdown testen
- [ ] Console Logs prÃ¼fen: `assigned: false`

---

## ğŸ¯ **MACH JETZT:**

1. **SQL Verify ausfÃ¼hren** (siehe oben)
2. **Screenshot** vom Ergebnis schicken
3. **DevTools Hard Refresh** (F12 â†’ Rechtsklick Reload)
4. **Console Logs** kopieren & schicken

**Dann sehe ich ob es ein Cache- oder Datenbank-Problem ist!** ğŸš€
