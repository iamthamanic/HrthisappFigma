# ğŸ¯ v4.8.0 - Card-Level Editing System - QUICK START

## âœ… **SCHRITT 1: SQL IN SUPABASE AUSFÃœHREN**

1. Gehe zu **Supabase SQL Editor**
2. Kopiere den Inhalt von `v4.8.0_FIX_MISSING_USER_COLUMNS.sql`
3. FÃ¼hre das SQL aus
4. Warte auf Success-Meldung: âœ… All user columns have been added successfully!

## âœ… **SCHRITT 2: APP TESTEN**

1. Ã–ffne die App
2. Navigiere zu **PersÃ¶nliche Einstellungen** (Ã¼ber Profilbild â†’ Einstellungen)
3. Du solltest jetzt **"Bearbeiten"-Buttons** unten rechts in jeder Card sehen:
   - âœ… PersÃ¶nliche Daten
   - âœ… Adresse
   - âœ… Bankverbindung
   - âœ… Arbeitskleidung GrÃ¶ÃŸen
   - âœ… Notfallkontakte
   - âœ… Sprachkenntnisse

## ğŸ® **WIE ES FUNKTIONIERT**

### **Card-Level Editing:**
- Jede Card hat einen eigenen **"Bearbeiten"-Button** unten rechts
- Nur **eine Card zur Zeit** kann bearbeitet werden
- Wenn du versuchst eine zweite Card zu bearbeiten â†’ **Warning Dialog**
- Jede Card hat eigene **Save/Cancel Buttons**

### **Permission-basiert:**
- Edit-Buttons werden nur angezeigt wenn User Berechtigung hat
- Disabled Buttons zeigen Tooltip: "Bitte speichern oder abbrechen Sie erst die aktuelle Bearbeitung"

### **Beispiel Workflow:**
1. User klickt "Bearbeiten" bei **Adresse Card**
2. Card wechselt in Edit-Mode mit Input-Feldern
3. User Ã¤ndert PLZ und Stadt
4. User klickt "Speichern" â†’ Daten werden gespeichert
5. Card wechselt zurÃ¼ck zu Readonly-Mode
6. Jetzt kann User eine andere Card bearbeiten

## ğŸ“¦ **NEUE KOMPONENTEN**

### **Shared Components:**
- `/hooks/HRTHIS_useCardEditing.ts` - Hook fÃ¼r Card-State-Management
- `/components/HRTHIS_EditWarningDialog.tsx` - Warning Dialog

### **User Card Components:**
- `/components/user/HRTHIS_PersonalDataCard.tsx` - PersÃ¶nliche Daten
- `/components/user/HRTHIS_AddressCard.tsx` - Adresse
- `/components/user/HRTHIS_BankInfoCard.tsx` - Bankverbindung
- `/components/user/HRTHIS_ClothingSizesCard.tsx` - KleidergrÃ¶ÃŸen
- `/components/user/HRTHIS_EmergencyContactCard.tsx` - Notfallkontakte
- `/components/user/HRTHIS_LanguageSkillsCard.tsx` - Sprachkenntnisse

### **Haupt-Komponente:**
- `/components/PersonalSettings.tsx` - Komplett neu mit Card-Level Editing

## ğŸ”§ **TECHNISCHE DETAILS**

### **useCardEditing Hook:**
```typescript
const cardEditing = useCardEditing();

// Check if card can be edited
const canEdit = cardEditing.canEdit('personal_info');

// Start editing (returns false if another card is editing)
const allowed = cardEditing.startEditing('personal_info');

// Stop editing
cardEditing.stopEditing();

// Get current editing card name for warning dialog
const currentCardName = cardEditing.currentCardName;
```

### **Card IDs:**
- `personal_info` - PersÃ¶nliche Daten
- `address` - Adresse
- `bank_info` - Bankverbindung
- `clothing_sizes` - KleidergrÃ¶ÃŸen
- `emergency_contact` - Notfallkontakte
- `language_skills` - Sprachkenntnisse

## ğŸ› **FEHLER BEHEBEN**

### **Fehler: "Could not find column 'gender'"**
â†’ **LÃ¶sung:** FÃ¼hre `v4.8.0_FIX_MISSING_USER_COLUMNS.sql` aus

### **Fehler: "Could not find column 'emergency_contacts'"**
â†’ **LÃ¶sung:** FÃ¼hre `v4.8.0_FIX_MISSING_USER_COLUMNS.sql` aus

### **Edit-Buttons werden nicht angezeigt**
â†’ **Check:** Permissions in `useFieldPermissions` Hook
â†’ **Check:** User Rolle (User, HR, Admin, etc.)

### **Warning Dialog erscheint sofort**
â†’ **Check:** Ist bereits eine Card im Edit-Mode?
â†’ **Fix:** Klicke "Abbrechen" bei der aktuellen Card

## ğŸ¨ **READONLY STYLING**

Die Cards nutzen die **field-readonly-v2** CSS Klassen aus `styles/globals.css`:

```css
.field-readonly-v2 {
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  padding: 0.5rem 0.75rem;
  border-radius: 0.375rem;
  color: #111827;
  min-height: 2.5rem;
}

.field-readonly-v2-empty {
  color: #9ca3af;
  font-style: italic;
}
```

## ğŸ“Š **NEXT STEPS**

Nach diesem Update solltest du testen:
1. âœ… Card-Level Editing in PersonalSettings.tsx
2. â³ Gleiche Cards in TeamMemberDetailsScreen.tsx (Admin-Ansicht)
3. â³ VehicleDetailScreen.tsx mit gleichem System

## ğŸš€ **VERSION INFO**

- **Version:** v4.8.0
- **Feature:** Card-Level Editing System
- **Files Changed:** 9 neue Files + 1 Ã¼berarbeitet
- **Database:** 11 neue Spalten in `users` Tabelle
- **Breaking Changes:** Keine - voll rÃ¼ckwÃ¤rtskompatibel

---

**âœ¨ Das Card-Level Editing System ist jetzt live! Viel Erfolg beim Testen! ğŸ‰**
