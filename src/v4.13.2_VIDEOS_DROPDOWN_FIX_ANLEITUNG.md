# üî• VIDEOS DROPDOWN FIX - COPY-PASTE ANLEITUNG

**Problem:** Videos werden nicht im Dropdown angezeigt!  
**Root Cause:** Videos haben `organization_id = NULL`  
**L√∂sung:** SQL Script ausf√ºhren!

---

## **üìã SCHRITT-F√úR-SCHRITT:**

### **Schritt 1: Supabase SQL Editor √∂ffnen**

1. Gehe zu: https://supabase.com/dashboard
2. W√§hle dein Projekt aus
3. Klicke links auf: **"SQL Editor"**
4. Klicke: **"New query"**

---

### **Schritt 2: SQL Code copy-pasten**

**Kopiere DIESEN CODE:**

```sql
-- ============================================================================
-- v4.13.2: AUTOMATISCHER FIX - Videos organization_id setzen
-- ============================================================================

DO $$
DECLARE
  default_org_id UUID;
  videos_updated INTEGER;
BEGIN
  -- Schritt 1: Finde die default organization
  SELECT id INTO default_org_id
  FROM organizations
  WHERE is_default = true
  LIMIT 1;

  -- Falls keine default org, nimm die erste
  IF default_org_id IS NULL THEN
    SELECT id INTO default_org_id
    FROM organizations
    ORDER BY created_at ASC
    LIMIT 1;
  END IF;

  -- Schritt 2: Zeige welche Org wir verwenden
  RAISE NOTICE '‚úÖ Using organization: %', default_org_id;

  -- Schritt 3: Update alle Videos mit NULL organization_id
  IF default_org_id IS NOT NULL THEN
    UPDATE video_content
    SET organization_id = default_org_id
    WHERE organization_id IS NULL;

    GET DIAGNOSTICS videos_updated = ROW_COUNT;

    RAISE NOTICE '‚úÖ Updated % videos with organization_id!', videos_updated;
  ELSE
    RAISE EXCEPTION '‚ùå ERROR: No organization found! Please create an organization first.';
  END IF;
END $$;

-- Verifiziere das Ergebnis
SELECT 
  '‚úÖ RESULT' as status,
  COUNT(*) as total_videos,
  COUNT(DISTINCT organization_id) as different_orgs,
  COUNT(CASE WHEN organization_id IS NULL THEN 1 END) as videos_still_null
FROM video_content;

-- Zeige alle Videos
SELECT 
  v.title,
  v.organization_id,
  o.name as organization_name
FROM video_content v
LEFT JOIN organizations o ON v.organization_id = o.id
ORDER BY v.created_at DESC;
```

---

### **Schritt 3: RUN ausf√ºhren**

1. Klicke auf: **"RUN"** (oder `Ctrl + Enter`)
2. Warte bis es durchgelaufen ist (ca. 2-3 Sekunden)

---

### **Schritt 4: Ergebnis pr√ºfen**

Du solltest **3 Tabellen** sehen:

#### **Tabelle 1: NOTICE Messages**
```
‚úÖ Using organization: <uuid>
‚úÖ Updated 2 videos with organization_id!
```

#### **Tabelle 2: RESULT**
```
status      | total_videos | different_orgs | videos_still_null
------------|--------------|----------------|------------------
‚úÖ RESULT   | 2            | 1              | 0
```

**‚úÖ WICHTIG:** `videos_still_null` muss **0** sein!

#### **Tabelle 3: Videos mit Organization**
```
title          | organization_id                      | organization_name
---------------|--------------------------------------|------------------
Video Titel 1  | abc-123-def-456                      | Meine Firma
Video Titel 2  | abc-123-def-456                      | Meine Firma
```

**‚úÖ WICHTIG:** Alle Videos m√ºssen eine `organization_id` haben!

---

### **Schritt 5: App testen**

1. **Hard Refresh:** `Strg + Shift + R`
2. **Lernverwaltung** ‚Üí **Videos Tab** √∂ffnen
3. **‚úÖ ERWARTUNG:** Alle Videos werden angezeigt!
4. **Test erstellen** ‚Üí **"Video verkn√ºpfen"** Dropdown √∂ffnen
5. **‚úÖ ERWARTUNG:** Alle Videos sind ausw√§hlbar!

---

## **üîç FALLS FEHLER:**

### **Error: "No organization found"**

**Problem:** Keine Organization in der Datenbank!

**L√∂sung:** Erstelle erst eine Organization:

```sql
-- Erstelle eine Default Organization
INSERT INTO organizations (name, is_default)
VALUES ('Meine Firma', true)
RETURNING id, name;
```

Dann f√ºhre das Fix-Script nochmal aus!

---

### **Error: "column organization_id does not exist"**

**Problem:** Tabelle `video_content` hat keine `organization_id` Spalte!

**L√∂sung:** F√ºge die Spalte hinzu:

```sql
-- F√ºge organization_id hinzu
ALTER TABLE video_content
ADD COLUMN IF NOT EXISTS organization_id UUID
REFERENCES organizations(id);
```

Dann f√ºhre das Fix-Script nochmal aus!

---

### **Error: "videos_still_null = 2" (nicht 0!)**

**Problem:** Das Update hat nicht funktioniert!

**Debug:** Pr√ºfe RLS Policies:

```sql
-- Zeige RLS Policies f√ºr video_content
SELECT 
  schemaname,
  tablename,
  policyname,
  permissive,
  roles,
  cmd,
  qual
FROM pg_policies
WHERE tablename = 'video_content';
```

**M√∂gliche L√∂sung:** RLS tempor√§r deaktivieren:

```sql
-- RLS tempor√§r deaktivieren
ALTER TABLE video_content DISABLE ROW LEVEL SECURITY;

-- Nochmal updaten
UPDATE video_content
SET organization_id = (SELECT id FROM organizations LIMIT 1)
WHERE organization_id IS NULL;

-- RLS wieder aktivieren
ALTER TABLE video_content ENABLE ROW LEVEL SECURITY;
```

---

## **‚úÖ NACH DEM FIX:**

### **Videos sollten jetzt sichtbar sein in:**

- ‚úÖ **Lernverwaltung ‚Üí Videos Tab**
- ‚úÖ **Test erstellen ‚Üí Video verkn√ºpfen Dropdown**
- ‚úÖ **Lernzentrum ‚Üí Videos**
- ‚úÖ **√úberall wo Videos angezeigt werden**

---

## **üíæ BACKUP ERSTELLEN (Optional aber empfohlen):**

**VORHER:**

```sql
-- Backup erstellen (falls was schief geht)
CREATE TABLE video_content_backup AS
SELECT * FROM video_content;

-- Pr√ºfen
SELECT COUNT(*) FROM video_content_backup;
```

**Falls Rollback n√∂tig:**

```sql
-- Videos wiederherstellen
TRUNCATE video_content;
INSERT INTO video_content SELECT * FROM video_content_backup;

-- Backup l√∂schen
DROP TABLE video_content_backup;
```

---

## **üéØ ZUSAMMENFASSUNG:**

1. **SQL Editor √∂ffnen**
2. **Code copy-pasten**
3. **RUN klicken**
4. **Pr√ºfen:** `videos_still_null = 0`
5. **App testen:** Hard Refresh + Videos checken

**Das war's!** üéâ

---

## **üìû SUPPORT:**

Falls es immer noch nicht funktioniert:

1. **Console Logs checken:**
   - `F12` ‚Üí Console
   - Suche nach: `[getVideos]` oder `[CreateTestDialog]`
   
2. **Screenshot machen:**
   - Vom SQL Editor Ergebnis
   - Von der Console
   - Vom Videos Dropdown

3. **Mir zeigen:**
   - Ich kann dann das Problem analysieren!

---

**LOS GEHT'S! Copy-Paste den SQL Code und f√ºhre ihn aus!** üöÄ
