SELECT 
  u.email,
  u.first_name || ' ' || u.last_name as name,
  u.role as global_role,
  tm.role as team_role,
  tm.priority_tag,
  t.name as team_name
FROM users u
LEFT JOIN team_members tm ON u.id = tm.user_id
LEFT JOIN teams t ON tm.team_id = t.id
ORDER BY t.name, tm.role DESC, tm.priority_tag ASC;