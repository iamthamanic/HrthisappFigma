# v4.7.3 - Profilbild Upload Fix

## ğŸ› Problem
Beim Hochladen eines Profilbildes erscheint die Fehlermeldung:
```
âŒ Error uploading profile picture: StorageApiError: Bucket not found
```

## ğŸ” Ursache
Der **Storage Bucket `profile-pictures`** existiert nicht in Supabase. Die App versucht Profilbilder hochzuladen, aber der Ziel-Bucket wurde nie erstellt.

## âœ… LÃ¶sung

### **Schritt 1: SQL-Script ausfÃ¼hren**

1. Ã–ffne dein **Supabase Dashboard**
2. Gehe zu **SQL Editor**
3. Erstelle eine **New Query**
4. Kopiere den **gesamten Inhalt** aus der Datei:
   ```
   v4.7.3_CREATE_PROFILE_PICTURES_BUCKET.sql
   ```
5. FÃ¼ge ihn ein und klicke **RUN**

### **Schritt 2: Bucket verifizieren**

Nach dem AusfÃ¼hren solltest du am Ende des Scripts diese Ausgabe sehen:

| id | name | public | file_size_limit | allowed_mime_types |
|---|---|---|---|---|
| profile-pictures | profile-pictures | true | 5242880 | {image/jpeg,image/jpg,image/png,image/webp} |

### **Schritt 3: Storage in Supabase UI checken**

1. Gehe zu **Storage** im Supabase Dashboard
2. Du solltest jetzt den Bucket **`profile-pictures`** sehen
3. Klicke drauf - er sollte leer sein (noch keine Uploads)

### **Schritt 4: Profilbild hochladen (Test)**

1. Gehe in deine App â†’ **"Personalakte (User)"**
2. Klicke **"Bild hochladen"**
3. WÃ¤hle ein Bild (quadratisch, min. 400x400px)
4. Croppe es
5. Klicke **"Ãœbernehmen"**

âœ… **Erfolg!** Das Bild sollte jetzt hochgeladen werden und Ã¼berall in der App erscheinen (Dashboard, Settings, etc.)

## ğŸ“‹ Was wurde erstellt?

### **1. Storage Bucket**
- **Name**: `profile-pictures`
- **Typ**: Public (Bilder sind Ã¶ffentlich zugÃ¤nglich)
- **Max. DateigrÃ¶ÃŸe**: 5MB
- **Erlaubte Formate**: JPEG, JPG, PNG, WebP

### **2. RLS Policies**
- âœ… **Public Read**: Jeder kann Profilbilder sehen
- âœ… **Authenticated Upload**: Nur angemeldete User kÃ¶nnen hochladen
- âœ… **Authenticated Update**: Nur angemeldete User kÃ¶nnen aktualisieren
- âœ… **Authenticated Delete**: Nur angemeldete User kÃ¶nnen lÃ¶schen

## ğŸ”§ Technische Details

### **Upload-Flow**
1. User wÃ¤hlt Bild â†’ ImageCropDialog Ã¶ffnet sich
2. User croppt Bild â†’ Blob wird erstellt
3. Blob wird zu Supabase Storage hochgeladen (`profile-pictures` Bucket)
4. Public URL wird generiert
5. URL wird in `users.profile_picture` gespeichert
6. Profile wird neu geladen â†’ Bild erscheint Ã¼berall

### **Code-Location**
- **Component**: `/components/PersonalSettings.tsx` (Zeile 342-376)
- **Bucket-Name**: `'profile-pictures'` (Zeile 345)
- **DB-Feld**: `users.profile_picture` (Zeile 361)

## ğŸ¯ Zusammenfassung

| Vorher | Nachher |
|--------|---------|
| âŒ Bucket existiert nicht | âœ… Bucket `profile-pictures` erstellt |
| âŒ Upload schlÃ¤gt fehl | âœ… Upload funktioniert |
| âŒ Nur Fallback-Initialen sichtbar | âœ… Echtes Profilbild wird angezeigt |

---

**Version**: v4.7.3  
**Datum**: 2025-01-16  
**Status**: âœ… Fix bereit zum Deployment
