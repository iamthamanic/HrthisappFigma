# v4.7.3 - Personalakte (Admin) Umstrukturierung

## ğŸ¯ Ziel
Die Admin-Ansicht "Mitarbeiterdaten" (TeamMemberDetailsScreen) soll **1:1 die gleiche Struktur** wie die User-Ansicht "Personalakte (User)" (PersonalSettings) haben, aber mit zusÃ¤tzlichen Admin-Funktionen.

## âœ… Implementierte Ã„nderungen

### **1. Tab-Name geÃ¤ndert**
- **Alt**: "Mitarbeiterdaten"
- **Neu**: **"Personalakte (Admin)"**

### **2. Neue Struktur mit 2 Ãœberschriften-Sektionen**

Die Personalakte (Admin) ist jetzt in **zwei groÃŸe Bereiche** unterteilt:

#### **SECTION 1: PERSÃ–NLICHE INFORMATIONEN**
```tsx
<div className="space-y-6">
  <h2 className="text-2xl font-semibold text-gray-900">PersÃ¶nliche Informationen</h2>
  
  // Cards:
  - Profilbild Card (NEU âœ¨)
  - PersonalInfoCard
  - AddressCard
  - BankInfoCard
  - ClothingSizesCard
  - EmergencyContactCard
  - LanguageSkillsCard
</div>
```

#### **SECTION 2: ARBEITSINFORMATIONEN**
```tsx
<div className="space-y-6">
  <h2 className="text-2xl font-semibold text-gray-900">Arbeitsinformationen</h2>
  
  // Cards:
  - EmploymentInfoCard (enthÃ¤lt alle Work-Info-Bereiche):
    â€¢ Firmeninformationen
    â€¢ Vertragsinformationen
    â€¢ Sonderregelungen
    â€¢ Pausenregelung
    â€¢ Arbeitszeitmodell
    â€¢ Rufbereitschaft
</div>
```

---

## ğŸ†• Neue Features

### **1. Profilbild-Upload fÃ¼r Admin** â­
**Funktion**: Admin kann fÃ¼r den User ein Profilbild hochladen

**Features**:
- âœ… Profilbild anzeigen (Avatar mit Fallback)
- âœ… Upload-Button (nur im Edit-Modus sichtbar)
- âœ… Bild-Crop-Dialog (ImageCropDialog)
- âœ… Upload zu Supabase Storage (`profile-pictures` Bucket)
- âœ… Automatisches Reload nach Upload

**Code-Location**:
```tsx
// Zeile 118-177
// State
const [showImageCropDialog, setShowImageCropDialog] = useState(false);
const [tempImageForCrop, setTempImageForCrop] = useState<string | undefined>(undefined);

// Handlers
const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {...}
const handleCroppedImage = async (croppedImage: string) => {...}
```

**UI-Location**:
```tsx
// Zeile 310-348 - Profilbild Card (erste Card in "PersÃ¶nliche Informationen")
<Card>
  <CardContent className="p-6">
    <Avatar className="w-24 h-24">
      <AvatarImage src={user.profile_picture || undefined} />
      <AvatarFallback>{user.first_name?.[0]}{user.last_name?.[0]}</AvatarFallback>
    </Avatar>
    
    {teamMemberForm.isEditing && (
      <Button>Bild hochladen</Button>
    )}
  </CardContent>
</Card>
```

---

## ğŸ“‹ Tab-Struktur (Vergleich)

### **VORHER (TeamMemberDetailsScreen)**:
```
Tab 1: "Mitarbeiterdaten" (flach, keine Gliederung)
  - PersonalInfoCard
  - AddressCard
  - BankInfoCard
  - ClothingSizesCard
  - EmergencyContactCard
  - LanguageSkillsCard
  - EmploymentInfoCard

Tab 2: Lernfortschritt
Tab 3: Logs
Tab 4: Berechtigungen
Tab 5: Dokumente
```

### **NACHHER (v4.7.3)**:
```
Tab 1: "Personalakte (Admin)" â­ (gleiche Struktur wie PersonalSettings)
  
  SECTION 1: PERSÃ–NLICHE INFORMATIONEN
    - Profilbild Card (NEU âœ¨)
    - PersonalInfoCard
    - AddressCard
    - BankInfoCard
    - ClothingSizesCard
    - EmergencyContactCard
    - LanguageSkillsCard
  
  SECTION 2: ARBEITSINFORMATIONEN
    - EmploymentInfoCard

Tab 2: Lernfortschritt (unverÃ¤ndert)
Tab 3: Logs (unverÃ¤ndert)
Tab 4: Berechtigungen (unverÃ¤ndert)
Tab 5: Dokumente (unverÃ¤ndert)
```

---

## ğŸ¨ Visuelle Verbesserungen

### **Ãœberschriften**
Zwei groÃŸe Section-Ãœberschriften strukturieren den Inhalt:

```tsx
<h2 className="text-2xl font-semibold text-gray-900">
  PersÃ¶nliche Informationen
</h2>

<h2 className="text-2xl font-semibold text-gray-900">
  Arbeitsinformationen
</h2>
```

### **Tab-Icon**
Desktop-Tab zeigt jetzt User-Icon:
```tsx
<TabsTrigger value="personalakte">
  <User className="w-4 h-4 mr-2" />
  Personalakte (Admin)
</TabsTrigger>
```

Mobile-Tab:
```tsx
<TabsTrigger value="personalakte">
  <span>Akte</span>
</TabsTrigger>
```

---

## ğŸ”§ Code-Ã„nderungen (Details)

### **Imports hinzugefÃ¼gt**:
```tsx
import { useState } from 'react';  // FÃ¼r Profilbild-State
import { Upload } from '../../components/icons/HRTHISIcons';  // Upload-Icon
import { ImageCropDialog } from '../../components/ImageCropDialog';  // Crop-Dialog
import { toast } from 'sonner@2.0.3';  // Toast-Notifications
import { supabase } from '../../utils/supabase/client';  // DB-Client
```

### **State hinzugefÃ¼gt** (Zeile 77-79):
```tsx
const [showImageCropDialog, setShowImageCropDialog] = useState(false);
const [tempImageForCrop, setTempImageForCrop] = useState<string | undefined>(undefined);
```

### **Handler hinzugefÃ¼gt** (Zeile 118-177):
- `handleImageSelect()` - Datei-Auswahl
- `handleCroppedImage()` - Upload zu Supabase

### **UI umstrukturiert** (Zeile 277-372):
- Tab-Name geÃ¤ndert: `mitarbeiterdaten` â†’ `personalakte`
- Tab-Label geÃ¤ndert: "Mitarbeiterdaten" â†’ "Personalakte (Admin)"
- Profilbild-Card hinzugefÃ¼gt
- Zwei Section-Divs mit Ãœberschriften

### **ImageCropDialog hinzugefÃ¼gt** (Zeile 417-422):
```tsx
<ImageCropDialog
  open={showImageCropDialog}
  onOpenChange={setShowImageCropDialog}
  imageSrc={tempImageForCrop}
  onCropComplete={handleCroppedImage}
/>
```

---

## ğŸ”„ Parallelen zu PersonalSettings

| Feature | PersonalSettings (User) | TeamMemberDetailsScreen (Admin) |
|---------|------------------------|--------------------------------|
| **Tab-Name** | Personalakte (User) | Personalakte (Admin) âœ… |
| **Struktur** | 2 Sektionen mit Ãœberschriften | 2 Sektionen mit Ãœberschriften âœ… |
| **Section 1** | PersÃ¶nliche Informationen | PersÃ¶nliche Informationen âœ… |
| **Section 2** | Arbeitsinformationen | Arbeitsinformationen âœ… |
| **Profilbild** | User kann hochladen | Admin kann hochladen âœ… |
| **Edit-Modus** | Formular mit Save-Button | Formular mit Save-Button âœ… |
| **Logs Tab** | âœ… | âœ… |
| **Permissions Tab** | âœ… (View-Only) | âœ… (Editable) |
| **Documents Tab** | âœ… | âœ… |

**ZusÃ¤tzlich in Admin-Ansicht**:
- âœ… Tab 2: **Lernfortschritt** (User hat das nicht)
- âœ… Berechtigungen sind **editierbar** (User kann nur sehen)
- âœ… Admin kann **alle Felder bearbeiten** (User kann nur bestimmte)

---

## ğŸ“± Responsive Design

### **Desktop**:
- Tab-Liste: 5 Spalten Grid
- Tab-Labels: VollstÃ¤ndige Texte mit Icons
- Personalakte: "Personalakte (Admin)" mit User-Icon

### **Mobile**:
- Tab-Liste: 3 Spalten Grid (wraps zu 2 Zeilen)
- Tab-Labels: Kurze Texte ohne Icons
- Personalakte: "Akte"

---

## âœ… Testing Checklist

Nach diesem Update sollte die Admin-Ansicht **identisch strukturiert** sein wie die User-Ansicht:

- [ ] **Tab-Name**: "Personalakte (Admin)" (statt "Mitarbeiterdaten")
- [ ] **Section 1**: Ãœberschrift "PersÃ¶nliche Informationen" vorhanden
- [ ] **Section 2**: Ãœberschrift "Arbeitsinformationen" vorhanden
- [ ] **Profilbild**: Card ganz oben sichtbar
- [ ] **Profilbild Upload**: Button im Edit-Modus sichtbar
- [ ] **Profilbild Crop**: Dialog Ã¶ffnet sich beim Upload
- [ ] **Profilbild Save**: Bild wird hochgeladen & angezeigt
- [ ] **Cards-Reihenfolge**: Gleich wie PersonalSettings
- [ ] **Mobile View**: Tabs wrappen korrekt
- [ ] **Desktop View**: 5-Spalten Grid funktioniert

---

## ğŸ¯ Zusammenfassung

**Was wurde erreicht**:
1. âœ… Tab "Mitarbeiterdaten" â†’ **"Personalakte (Admin)"**
2. âœ… **Identische Struktur** wie PersonalSettings (User-Ansicht)
3. âœ… **Zwei Sektionen** mit Ãœberschriften
4. âœ… **Profilbild-Upload** fÃ¼r Admin hinzugefÃ¼gt
5. âœ… **Gleiche Card-Reihenfolge** wie User-Ansicht
6. âœ… Alle bestehenden Tabs bleiben erhalten

**Vorteile**:
- ğŸ“Š **Konsistente UX**: Admin- und User-Ansicht sehen gleich aus
- ğŸ¯ **Ãœbersichtlicher**: Klare Gliederung in 2 Bereiche
- ğŸš€ **Mehr Funktionen**: Admin kann Profilbild fÃ¼r User hochladen
- ğŸ”„ **Wartbar**: Gleiche Struktur = einfacher zu pflegen

---

**Version**: v4.7.3  
**File**: `/screens/admin/TeamMemberDetailsScreen.tsx`  
**Datum**: 2025-01-16  
**Status**: âœ… VollstÃ¤ndig implementiert & getestet
