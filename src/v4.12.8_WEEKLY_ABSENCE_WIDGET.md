# âœ… v4.12.8 - WÃ¶chentliche Abwesenheits-Ãœbersicht im Mini-Kalender

## ğŸ¯ Feature

**Abwesenheits-Widget** im Mini-Kalender Bereich zeigt alle Mitarbeiter, die in der ausgewÃ¤hlten Woche abwesend sind:

- **Gruppierung:** Nach Abwesenheitstyp (Krank, Urlaub, Unbezahlte Abwesenheit)
- **Anzeige:** Profilbilder der abwesenden Mitarbeiter
- **Hover-Tooltip:** Name, Abwesenheitstyp, Von-Bis Datum
- **Live-Update:** Aktualisiert sich bei Wochenwechsel

---

## ğŸ¨ Visuelle Darstellung

### **Layout im Mini-Kalender:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mini-Kalender                   â”‚
â”‚  Mo Di Mi Do Fr Sa So           â”‚
â”‚  [Kalender Grid]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— Heute  â— Feiertag (Legende)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† NEU!
â”‚ Abwesenheiten              (3)  â”‚
â”‚                                 â”‚
â”‚ Krank: (1)                      â”‚
â”‚  [ğŸ‘¤]                           â”‚
â”‚                                 â”‚
â”‚ Urlaub: (2)                     â”‚
â”‚  [ğŸ‘¤] [ğŸ‘¤]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Hover-Tooltip Beispiel:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Max Mustermann          â”‚ â† Name (bold)
â”‚ Krank                   â”‚ â† Typ
â”‚ 04.11.2025 - 06.11.2025 â”‚ â† Von-Bis
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Farbcodierung:**

| Typ | Avatar Ring | Farbe |
|-----|-------------|-------|
| **Krank** | Rot | `border-red-300` |
| **Urlaub** | Blau | `border-blue-300` |
| **Unbezahlte Abwesenheit** | Grau | `border-gray-300` |

---

## ğŸ’» Implementierung

### **Neue Komponente: BrowoKo_WeeklyAbsenceWidget.tsx**

**Props:**
```tsx
interface WeeklyAbsenceWidgetProps {
  selectedWeek: Date;  // AusgewÃ¤hlte Woche
}
```

**Funktionsweise:**

1. **Fetch Absences:**
```tsx
const weekStart = startOfWeek(selectedWeek, { weekStartsOn: 1 });
const weekEnd = endOfWeek(selectedWeek, { weekStartsOn: 1 });

const { data } = await supabase
  .from('leave_requests')
  .select(`
    id, user_id, leave_type, start_date, end_date, status,
    users:user_id (id, first_name, last_name, profile_picture)
  `)
  .eq('status', 'approved')
  .or(`start_date.lte.${weekEnd},end_date.gte.${weekStart}`)
  .order('start_date', { ascending: true });
```

2. **Gruppierung:**
```tsx
const groupedAbsences = {
  sick: [],      // Krank
  vacation: [],  // Urlaub
  unpaid: []     // Unbezahlt
};

absences.forEach(absence => {
  groups[absence.leave_type].push(absence);
});
```

3. **Render:**
```tsx
{Object.entries(groupedAbsences).map(([type, items]) => (
  <div key={type}>
    <span>{LEAVE_TYPE_LABELS[type]}: ({items.length})</span>
    <div className="flex flex-wrap gap-1.5">
      {items.map(absence => (
        <Tooltip>
          <TooltipTrigger>
            <Avatar className="h-7 w-7 ring-2 {COLOR}" />
          </TooltipTrigger>
          <TooltipContent>
            {/* Name, Typ, Von-Bis */}
          </TooltipContent>
        </Tooltip>
      ))}
    </div>
  </div>
))}
```

---

### **Integration in BrowoKo_ShiftPlanningTab.tsx**

**Import:**
```tsx
import { BrowoKo_WeeklyAbsenceWidget } from './BrowoKo_WeeklyAbsenceWidget';
```

**Placement:**
```tsx
<Card>
  <CardContent className="pt-4 pb-3">
    <div className="max-w-sm">
      <BrowoKo_MiniCalendar 
        selectedWeek={selectedWeek}
        onWeekChange={setSelectedWeek}
      />
      
      {/* Legende */}
      <div className="mt-3 ...">
        {/* Heute, Feiertag */}
      </div>

      {/* Abwesenheiten Widget */}
      <BrowoKo_WeeklyAbsenceWidget selectedWeek={selectedWeek} /> â† NEU!
    </div>
  </CardContent>
</Card>
```

---

## ğŸ“Š Datenstruktur

### **leave_requests Tabelle:**

```sql
Table: leave_requests
Columns:
- id (uuid)
- user_id (uuid) â†’ FK to users
- leave_type (enum: 'sick' | 'vacation' | 'unpaid')
- start_date (date)
- end_date (date)
- status (enum: 'pending' | 'approved' | 'rejected')
- created_at (timestamp)
```

### **Query Logic:**

**Woche Ã¼berschneidet sich mit Abwesenheit:**
```
Abwesenheit:  [â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€]
Woche:            [â”€â”€â”€â”€â”€â”€]

Bedingung: start_date <= weekEnd AND end_date >= weekStart
```

**Beispiel:**
```
Woche: 04.11.2025 - 10.11.2025

Abwesenheit 1: 03.11 - 05.11 âœ“ (Ã¼berschneidet sich)
Abwesenheit 2: 06.11 - 08.11 âœ“ (komplett in Woche)
Abwesenheit 3: 08.11 - 12.11 âœ“ (Ã¼berschneidet sich)
Abwesenheit 4: 01.11 - 02.11 âœ— (vor Woche)
Abwesenheit 5: 15.11 - 20.11 âœ— (nach Woche)
```

---

## ğŸ¨ UI Details

### **Header Section:**

```tsx
<div className="flex items-center justify-between">
  <span className="text-xs font-medium text-gray-700">
    Abwesenheiten
  </span>
  <Badge variant="secondary" className="text-[10px]">
    {totalAbsences}
  </Badge>
</div>
```

**Styling:**
- Header: `text-xs font-medium`
- Badge: `text-[10px]` (sehr klein)
- Kompakt fÃ¼r Mini-Kalender Bereich

---

### **Type Groups:**

```tsx
<div className="space-y-2">
  {/* Krank */}
  <div className="space-y-1.5">
    <div className="flex items-center gap-2">
      <span className="text-[11px] font-medium text-gray-600">
        Krank:
      </span>
      <span className="text-[10px] text-gray-500">
        (1)
      </span>
    </div>
    
    {/* Avatars */}
    <div className="flex flex-wrap gap-1.5">
      {/* Avatar components */}
    </div>
  </div>
  
  {/* Urlaub, Unbezahlt... */}
</div>
```

---

### **Avatar mit Ring:**

```tsx
<div className={`
  relative rounded-full ring-2 
  ${LEAVE_TYPE_COLORS[type]} 
  ring-offset-1 
  cursor-pointer 
  hover:scale-110 
  transition-transform
`}>
  <Avatar className="h-7 w-7">
    <AvatarImage src={profile_picture} />
    <AvatarFallback className="text-[10px]">
      {initials}
    </AvatarFallback>
  </Avatar>
</div>
```

**Features:**
- `ring-2` â†’ 2px Border
- `ring-offset-1` â†’ 1px Abstand zwischen Avatar und Ring
- `hover:scale-110` â†’ VergrÃ¶ÃŸert sich beim Hover
- `transition-transform` â†’ Smooth Animation

---

### **Tooltip Content:**

```tsx
<TooltipContent side="top" className="max-w-[200px]">
  <div className="space-y-1">
    {/* Name */}
    <p className="font-semibold text-xs">
      Max Mustermann
    </p>
    
    {/* Typ */}
    <p className="text-[11px] text-gray-600">
      Krank
    </p>
    
    {/* Datum */}
    <p className="text-[11px] text-gray-500">
      04.11.2025 - 06.11.2025
    </p>
  </div>
</TooltipContent>
```

**Positioning:**
- `side="top"` â†’ Tooltip erscheint Ã¼ber Avatar
- `max-w-[200px]` â†’ Begrenzte Breite
- Kompakte SchriftgrÃ¶ÃŸen (`text-xs`, `text-[11px]`)

---

## ğŸ”„ States & Loading

### **Empty State:**

```tsx
if (totalAbsences === 0) {
  return (
    <div className="pt-3 border-t">
      <div className="flex items-center justify-between mb-2">
        <span className="text-xs font-medium text-gray-700">
          Abwesenheiten
        </span>
        <Badge variant="secondary" className="text-[10px]">
          0
        </Badge>
      </div>
      <p className="text-[11px] text-gray-500">
        Keine Abwesenheiten diese Woche
      </p>
    </div>
  );
}
```

---

### **Loading State:**

```tsx
if (loading) {
  return (
    <div className="pt-3 border-t">
      <div className="text-xs text-gray-500">
        Lade Abwesenheiten...
      </div>
    </div>
  );
}
```

---

## ğŸ“± Responsive Behavior

### **Desktop:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Abwesenheiten      (3)  â”‚
â”‚                         â”‚
â”‚ Krank: (1)              â”‚
â”‚  [ğŸ‘¤]                   â”‚
â”‚                         â”‚
â”‚ Urlaub: (2)             â”‚
â”‚  [ğŸ‘¤] [ğŸ‘¤]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Mobile (falls viele Mitarbeiter):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Abwesenheiten      (8)  â”‚
â”‚                         â”‚
â”‚ Krank: (3)              â”‚
â”‚  [ğŸ‘¤] [ğŸ‘¤] [ğŸ‘¤]         â”‚
â”‚                         â”‚
â”‚ Urlaub: (5)             â”‚
â”‚  [ğŸ‘¤] [ğŸ‘¤] [ğŸ‘¤]         â”‚
â”‚  [ğŸ‘¤] [ğŸ‘¤]              â”‚ â† Wrapping
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Flex Wrap:**
```tsx
<div className="flex flex-wrap gap-1.5">
  {/* Avatars wrappen bei zu vielen */}
</div>
```

---

## ğŸ¯ Use Cases

### **Use Case 1: Schichtplanung mit Abwesenheiten**

```
Szenario: HR plant Schichten fÃ¼r KW 45

1. WÃ¤hlt KW 45 im Mini-Kalender
   â””â”€â†’ Widget zeigt: 3 Mitarbeiter abwesend

2. Sieht auf einen Blick:
   - Max (Krank: 04.11-06.11)
   - Anna (Urlaub: 04.11-10.11)
   - Tom (Urlaub: 08.11-10.11)

3. Plant Schichten unter BerÃ¼cksichtigung der Abwesenheiten
   â””â”€â†’ WeiÃŸ genau wer NICHT verfÃ¼gbar ist

4. Hover Ã¼ber Avatar fÃ¼r Details:
   â””â”€â†’ "Anna Schmidt, Urlaub, 04.11.2025 - 10.11.2025"
```

---

### **Use Case 2: Schneller Ãœberblick**

```
Workflow: TÃ¤gliche Schichtplanung

1. Ã–ffnet Schichtplanung
2. Blick auf Widget: "5 Abwesenheiten"
3. Sieht sofort:
   âœ“ 2 krank
   âœ“ 3 im Urlaub
4. Plant entsprechend um
```

---

### **Use Case 3: Wochenwechsel**

```
Aktion: WÃ¤hlt nÃ¤chste Woche

1. Click auf "â†’" im Mini-Kalender
2. Woche wechselt: KW 45 â†’ KW 46
3. Widget updated automatisch:
   - LÃ¤dt neue Abwesenheiten
   - Zeigt andere Mitarbeiter
   - Update in <1 Sekunde

Beispiel:
KW 45: 3 Abwesenheiten (Max, Anna, Tom)
KW 46: 1 Abwesenheit (nur Lisa)
```

---

## ğŸ§ª Testing

### **Test 1: Basis-Anzeige**
1. Ã–ffne Schichtplanung
2. WÃ¤hle Woche mit Abwesenheiten
3. **Erwartung:** Widget zeigt Abwesenheiten
4. **Erwartung:** Gruppierung nach Typ
5. **Erwartung:** Count stimmt

### **Test 2: Hover-Tooltip**
1. Hover Ã¼ber Avatar
2. **Erwartung:** Tooltip erscheint oben
3. **Erwartung:** Zeigt Name, Typ, Datum
4. **Erwartung:** Datum im Format DD.MM.YYYY

### **Test 3: Empty State**
1. WÃ¤hle Woche ohne Abwesenheiten
2. **Erwartung:** "Keine Abwesenheiten diese Woche"
3. **Erwartung:** Badge zeigt (0)

### **Test 4: Wochenwechsel**
1. WÃ¤hle Woche A (3 Abwesenheiten)
2. Wechsle zu Woche B (1 Abwesenheit)
3. **Erwartung:** Widget updated automatisch
4. **Erwartung:** Zeigt neue Abwesenheiten
5. **Erwartung:** Keine alten Daten

### **Test 5: Farbcodierung**
1. PrÃ¼fe Avatars:
   - Krank â†’ Roter Ring
   - Urlaub â†’ Blauer Ring
   - Unbezahlt â†’ Grauer Ring
2. **Erwartung:** Korrekte Farben
3. **Erwartung:** Ring deutlich sichtbar

---

## ğŸ¨ Styling Details

### **Spacing & Layout:**

```css
/* Container */
pt-3         /* Padding top (12px) */
border-t     /* Top border */
space-y-3    /* Vertical spacing (12px) */

/* Type Groups */
space-y-2    /* 8px zwischen Gruppen */
space-y-1.5  /* 6px zwischen Label und Avatars */

/* Avatars */
gap-1.5      /* 6px zwischen Avatars */
flex-wrap    /* Wrapping bei vielen */
```

---

### **Colors:**

```tsx
// Sick (Krank)
const SICK_COLORS = {
  ring: 'border-red-300',      // #FCA5A5
  bg: 'bg-red-100',            // #FEE2E2
  text: 'text-red-700'         // #B91C1C
};

// Vacation (Urlaub)
const VACATION_COLORS = {
  ring: 'border-blue-300',     // #93C5FD
  bg: 'bg-blue-100',           // #DBEAFE
  text: 'text-blue-700'        // #1D4ED8
};

// Unpaid (Unbezahlt)
const UNPAID_COLORS = {
  ring: 'border-gray-300',     // #D1D5DB
  bg: 'bg-gray-100',           // #F3F4F6
  text: 'text-gray-700'        // #374151
};
```

---

### **Typography:**

| Element | Font Size | Weight |
|---------|-----------|--------|
| Header "Abwesenheiten" | `text-xs` (12px) | `font-medium` |
| Type Label "Krank:" | `text-[11px]` | `font-medium` |
| Count "(1)" | `text-[10px]` | Normal |
| Badge | `text-[10px]` | Normal |
| Tooltip Name | `text-xs` (12px) | `font-semibold` |
| Tooltip Details | `text-[11px]` | Normal |

---

## ğŸš€ Performance

### **Optimierungen:**

1. **useMemo fÃ¼r Gruppierung:**
```tsx
const groupedAbsences = useMemo(() => {
  // Gruppierung nur bei DatenÃ¤nderung
}, [absences]);
```

2. **Effiziente Query:**
```sql
-- Nur approved Requests
.eq('status', 'approved')

-- Nur relevante Woche
.or(`start_date.lte.${weekEnd},end_date.gte.${weekStart}`)

-- Sortiert
.order('start_date', { ascending: true })
```

3. **Lazy Loading:**
- Widget lÃ¤dt nur bei Bedarf
- useEffect triggered bei Wochenwechsel
- Keine unnÃ¶tigen Requests

---

## ğŸ“Š Visual Comparison

### **VORHER (v4.12.7):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mini-Kalender           â”‚
â”‚  Mo Di Mi Do Fr Sa So   â”‚
â”‚  [Kalender Grid]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— Heute  â— Feiertag     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
   (Whitespace)
```

---

### **NACHHER (v4.12.8):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mini-Kalender           â”‚
â”‚  Mo Di Mi Do Fr Sa So   â”‚
â”‚  [Kalender Grid]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— Heute  â— Feiertag     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† Neue Border
â”‚ Abwesenheiten      (3)  â”‚ â† NEU!
â”‚                         â”‚
â”‚ Krank: (1)              â”‚
â”‚  [ğŸ‘¤]                   â”‚ â† Avatar mit rotem Ring
â”‚                         â”‚
â”‚ Urlaub: (2)             â”‚
â”‚  [ğŸ‘¤] [ğŸ‘¤]              â”‚ â† Avatars mit blauem Ring
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Benefits

### **FÃ¼r HR / Schichtplaner:**
âœ… **Schneller Ãœberblick:** Alle Abwesenheiten auf einen Blick  
âœ… **Kontextbezogen:** Nur fÃ¼r ausgewÃ¤hlte Woche  
âœ… **Details per Hover:** Kein zusÃ¤tzlicher Click nÃ¶tig  
âœ… **Farbcodierung:** Sofort erkennbar (Krank vs Urlaub)  
âœ… **Bessere Planung:** BerÃ¼cksichtigung von Abwesenheiten  

### **FÃ¼r UX:**
âœ… **Platzsparend:** Nutzt Whitespace im Mini-Kalender  
âœ… **Intuitiv:** Profilbilder sofort erkennbar  
âœ… **Interaktiv:** Hover fÃ¼r Details  
âœ… **Live-Update:** Automatisch bei Wochenwechsel  
âœ… **Konsistent:** Passt zu bestehendem Design  

---

## ğŸ“ Zusammenfassung

**New Component:**
- âœ… `/components/BrowoKo_WeeklyAbsenceWidget.tsx` - Abwesenheits-Widget

**Changed Files:**
- âœ… `/components/BrowoKo_ShiftPlanningTab.tsx` - Widget Integration

**Features:**
- âœ… Abwesenheits-Anzeige fÃ¼r ausgewÃ¤hlte Woche
- âœ… Gruppierung nach Typ (Krank, Urlaub, Unbezahlt)
- âœ… Profilbilder mit Farbcodierung
- âœ… Hover-Tooltip mit Details
- âœ… Empty State fÃ¼r keine Abwesenheiten
- âœ… Live-Update bei Wochenwechsel

**Lines of Code:** ~200 (neue Komponente)

**Impact:**
- ğŸ¯ **Planning:** Bessere Schichtplanung mit Abwesenheits-Ãœberblick
- ğŸ¨ **Visual:** Nutzt Whitespace optimal
- ğŸ“Š **Data:** Relevante Informationen kontextbezogen
- ğŸš€ **UX:** Schneller Zugriff ohne Extra-Clicks

---

**Version:** v4.12.8  
**Type:** Feature - Weekly Absence Overview Widget  
**Status:** âœ… **COMPLETE - PRODUCTION READY**
