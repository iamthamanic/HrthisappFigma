# âœ… v4.12.4 - Mitarbeiter-Info-Karte im Schichtplanung Tab

## ğŸ¯ Feature Beschreibung

Neben dem Mini-Kalender wird jetzt eine **detaillierte Mitarbeiter-Informations-Karte** angezeigt, die alle relevanten Daten des ausgewÃ¤hlten Mitarbeiters zeigt.

---

## ğŸ“Š Was zeigt die Info-Karte?

### **1. Profil-Informationen**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ [Profilbild]  Max Mustermann    â”‚
â”‚                  max@example.com   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Standort: Berlin Mitte          â”‚
â”‚ ğŸ’¼ Abteilung: Produktion           â”‚
â”‚ ğŸ“ˆ Spezialisierung: Backstube      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Monatliche Stunden-Ãœbersicht**
```
Stunden im November                [92%]
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Geleistet:    73.5h                 â”‚
â”‚ Soll (bisher): 80.0h                â”‚
â”‚ Monatssoll:   160.0h                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘] 92%           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Farbcodierung:**
- ğŸŸ¢ **GrÃ¼n** (â‰¥90%): Ziel erreicht
- ğŸŸ¡ **Gelb** (70-89%): Im Plan
- ğŸ”´ **Rot** (<70%): RÃ¼ckstand

**Berechnung:**
- `Monatssoll gesamt` = (Wochenstunden / 7) Ã— Tage im Monat
- `Soll (bisher)` = (Wochenstunden / 7) Ã— Aktueller Tag
- `Geleistet` = Summe aller abgestempelten Arbeitszeiten im Monat
- `Prozentsatz` = (Geleistet / Soll bisher) Ã— 100%

### **3. Letzte AktivitÃ¤t**
```
Letzte AktivitÃ¤t
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“… Letzter Arbeitstag: 03.11.2025   â”‚
â”‚ ğŸšª Ausgestempelt um: 17:30 Uhr      â”‚
â”‚ â±ï¸  Arbeitszeit: 8h 30m              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Datenquelle:**
- Letzte `work_session` des Mitarbeiters im aktuellen Monat
- Zeigt nur Sessions mit `clock_out` (abgestempelt)

### **4. Durchschnittliche Schichtzeiten (Filterbar!)**
```
Durchschn. Schichtzeiten  [7T][14T][30T]
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ã˜ SchichtlÃ¤nge:     8h 15m          â”‚
â”‚ HÃ¤ufigster Start:   07:00 Uhr       â”‚
â”‚ Schichten gesamt:   5               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Filter-Optionen:**
- **7 Tage**: Letzte Woche
- **14 Tage**: Letzte 2 Wochen
- **30 Tage**: Letzter Monat

**Berechnung:**
- `Ã˜ SchichtlÃ¤nge` = Durchschnitt aller Schicht-Dauern im Zeitraum
- `HÃ¤ufigster Start` = Modus (most common) der Start-Zeiten
- `Schichten gesamt` = Anzahl Schichten im Zeitraum

---

## ğŸ¨ Layout & UX

### **Desktop (â‰¥1024px)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mini-Kalender                â”‚  Mitarbeiter-Info       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Nov 2025     â”‚            â”‚  â”‚ ğŸ‘¤ Max M.    â”‚       â”‚
â”‚  â”‚ Mo Di Mi ... â”‚            â”‚  â”‚ ğŸ“ Berlin    â”‚       â”‚
â”‚  â”‚ [Kalender]   â”‚            â”‚  â”‚ ğŸ’¼ Produktionâ”‚       â”‚
â”‚  â”‚              â”‚            â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚       â”‚
â”‚  â”‚ Legende      â”‚            â”‚  â”‚ Stunden: 92% â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚ Letzte Akt.  â”‚       â”‚
â”‚                               â”‚  â”‚ Ã˜ Schichten  â”‚       â”‚
â”‚                               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mitarbeiter-Liste            â”‚  Wochenansicht         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ [Filter]     â”‚            â”‚  â”‚ Mo Di Mi ... â”‚       â”‚
â”‚  â”‚ - Anna       â”‚            â”‚  â”‚ [Timeline]   â”‚       â”‚
â”‚  â”‚ - Max   â† Selected         â”‚  â”‚              â”‚       â”‚
â”‚  â”‚ - Sarah      â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Mobile (<1024px)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mini-Kalender       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Kalender]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mitarbeiter-Info    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Bitte auswÃ¤hlenâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mitarbeiter-Liste   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Filter]       â”‚  â”‚
â”‚  â”‚ - Anna         â”‚  â”‚
â”‚  â”‚ - Max          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Wochenansicht       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Timeline]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» Implementierung

### **Neue Komponente: `BrowoKo_EmployeeInfoCard.tsx`**

```typescript
interface EmployeeInfoCardProps {
  selectedUser: User | null;
  locations: Location[];
}

export function BrowoKo_EmployeeInfoCard({ 
  selectedUser, 
  locations 
}: EmployeeInfoCardProps)
```

**Features:**
- âœ… **Empty State**: Zeigt Platzhalter wenn kein User ausgewÃ¤hlt
- âœ… **Live Data**: LÃ¤dt `work_sessions` und `shifts` aus Supabase
- âœ… **Filter-Buttons**: 7/14/30 Tage fÃ¼r Schicht-Analyse
- âœ… **Progress Bar**: Visuelle Stunden-Darstellung
- âœ… **Farbcodierung**: GrÃ¼n/Gelb/Rot basierend auf Stunden-Prozentsatz
- âœ… **Responsive**: Mobile-optimiert

### **Integration in `BrowoKo_ShiftPlanningTab.tsx`**

**1. Import hinzugefÃ¼gt:**
```typescript
import { BrowoKo_EmployeeInfoCard } from './BrowoKo_EmployeeInfoCard';
```

**2. State hinzugefÃ¼gt:**
```typescript
const [selectedUserForInfo, setSelectedUserForInfo] = useState<User | null>(null);
```

**3. Layout angepasst:**
```typescript
{/* TOP: Mini-Kalender & Mitarbeiter-Info nebeneinander */}
<div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
  {/* LEFT: Mini-Kalender */}
  <Card>...</Card>

  {/* RIGHT: Mitarbeiter-Info-Karte */}
  <BrowoKo_EmployeeInfoCard 
    selectedUser={selectedUserForInfo}
    locations={locations}
  />
</div>
```

**4. Click-Handler erweitert:**
```typescript
onClick={() => {
  setSelectedUserForShift(user);
  setSelectedUserForInfo(user); // âœ… Update Info-Karte
  setEditShift(null);
  setCreateShiftDialogOpen(true);
}}
```

---

## ğŸ—„ï¸ Datenquellen

### **1. Work Sessions (Zeiterfassung)**
```sql
SELECT * FROM work_sessions
WHERE user_id = $1
  AND clock_in >= $2  -- Start of month
  AND clock_in <= $3  -- End of month
  AND clock_out IS NOT NULL
ORDER BY clock_in DESC;
```

**Verwendung:**
- Monatliche Stunden berechnen
- Letzte AktivitÃ¤t anzeigen
- Ausstempel-Zeit

### **2. Shifts (Schichtplanung)**
```sql
SELECT * FROM shifts
WHERE user_id = $1
  AND date >= $2  -- Range start (7/14/30 days ago)
  AND date <= $3  -- Today
ORDER BY date DESC;
```

**Verwendung:**
- Durchschnittliche SchichtlÃ¤nge
- HÃ¤ufigster Start-Zeit
- Schicht-Count

### **3. Users & Locations**
```typescript
// Von BrowoKo_useShiftPlanning Hook
const { locations, users } = BrowoKo_useShiftPlanning(selectedWeek);
```

**Verwendung:**
- Profil-Informationen
- Standort-Name
- Abteilung, Spezialisierung
- Wochenstunden (fÃ¼r Soll-Berechnung)

---

## ğŸ¯ User Experience

### **Workflow:**

1. **Initial State:**
   ```
   "Bitte Mitarbeiter:in auswÃ¤hlen um Informationen zu erhalten"
   ```

2. **User klickt auf Mitarbeiter:**
   ```
   â†’ selectedUserForInfo wird gesetzt
   â†’ Daten werden geladen (work_sessions, shifts)
   â†’ Info-Karte zeigt alle Details
   â†’ Dialog Ã¶ffnet sich fÃ¼r Schicht-Erstellung
   ```

3. **User Ã¤ndert Zeitraum-Filter:**
   ```
   [7T] [14T] [30T]  â† Click
   â†’ Shifts werden neu geladen
   â†’ Durchschnitt wird neu berechnet
   â†’ UI updated automatisch
   ```

4. **User wÃ¤hlt anderen Mitarbeiter:**
   ```
   â†’ selectedUserForInfo wird aktualisiert
   â†’ Neue Daten werden geladen
   â†’ Info-Karte zeigt neue Details
   ```

---

## ğŸ“± Responsive Verhalten

### **Breakpoints:**

| Screen Size | Layout                          |
|-------------|---------------------------------|
| < 1024px    | Stacked (Kalender â†’ Info â†’ List)|
| â‰¥ 1024px    | Grid (2 Spalten oben, 2 unten) |

### **Mobile Optimierungen:**
- âœ… Touch-friendly Buttons (min 44x44px)
- âœ… Scrollbare Inhalte wenn nÃ¶tig
- âœ… Kompakte Text-GrÃ¶ÃŸen (text-xs, text-sm)
- âœ… Badges fÃ¼r wichtige Metriken

---

## ğŸ§ª Testing

### **Test Cases:**

**1. Empty State:**
```
âœ“ Zeigt Platzhalter wenn kein User ausgewÃ¤hlt
âœ“ Icon und Text sind zentriert
âœ“ Keine API-Calls bei leerem State
```

**2. Data Loading:**
```
âœ“ work_sessions werden fÃ¼r aktuellen Monat geladen
âœ“ shifts werden fÃ¼r gewÃ¤hlten Zeitraum geladen
âœ“ Loading-State wird angezeigt wÃ¤hrend Fetch
```

**3. Calculations:**
```
âœ“ Monatsstunden werden korrekt berechnet
âœ“ Prozentsatz ist akkurat
âœ“ Durchschnittliche Schichtzeit stimmt
âœ“ HÃ¤ufigster Start wird korrekt ermittelt
```

**4. Filter:**
```
âœ“ 7 Tage Filter funktioniert
âœ“ 14 Tage Filter funktioniert
âœ“ 30 Tage Filter funktioniert
âœ“ Active State wird visuell angezeigt
```

**5. Edge Cases:**
```
âœ“ User ohne work_sessions â†’ "Keine AktivitÃ¤ten"
âœ“ User ohne shifts â†’ "Keine Schichten"
âœ“ User ohne location â†’ "Nicht zugewiesen"
âœ“ User ohne department â†’ "Nicht zugewiesen"
```

---

## ğŸ”§ Konfiguration

### **Anpassbare Werte:**

```typescript
// In BrowoKo_EmployeeInfoCard.tsx

// Default Zeitraum-Filter
const [timeRange, setTimeRange] = useState<TimeRangeFilter>(7); // 7, 14, oder 30

// Farb-Schwellenwerte fÃ¼r Stunden-Prozentsatz
const progressColor = 
  percentage >= 90 ? 'bg-green-500' :   // â† Anpassbar
  percentage >= 70 ? 'bg-yellow-500' :  // â† Anpassbar
  'bg-red-500';

// Default Wochenstunden (falls nicht gesetzt)
const weeklyHours = selectedUser.weekly_hours || 40; // â† Anpassbar
```

---

## ğŸ“š Verwendete Icons

| Icon            | Verwendung               |
|-----------------|--------------------------|
| `Calendar`      | Kalender, Arbeitstag     |
| `MapPin`        | Standort                 |
| `Briefcase`     | Abteilung                |
| `TrendingUp`    | Spezialisierung          |
| `Clock`         | Stunden, Arbeitszeit     |
| `LogOut`        | Ausstempeln              |

---

## ğŸ‰ Vorteile

### **FÃ¼r HR / Schichtplaner:**
âœ… Schneller Ãœberblick Ã¼ber Mitarbeiter-Status  
âœ… Sieht sofort, ob Stunden-Ziel erreicht wird  
âœ… Kann letzte AktivitÃ¤t prÃ¼fen  
âœ… Erkennt Schicht-Muster (Durchschnitt)  

### **FÃ¼r Schichtplanung:**
âœ… Bessere Entscheidungen beim Zuweisen von Schichten  
âœ… Vermeidung von Ãœberlastung (Stunden-Check)  
âœ… BerÃ¼cksichtigung von typischen Schichtzeiten  

### **FÃ¼r System:**
âœ… Alle Daten werden live aus DB geladen  
âœ… Keine Dummy-Daten  
âœ… Echte Berechnung basierend auf Zeiterfassung  

---

## ğŸš€ Next Steps (Optional)

**MÃ¶gliche Erweiterungen:**
- [ ] Export der Mitarbeiter-Daten als PDF
- [ ] Vergleich mit anderen Mitarbeitern
- [ ] Historische Trends (Monat-zu-Monat)
- [ ] Ãœberstunden-Anzeige
- [ ] Urlaubstage-Integration
- [ ] Team-Durchschnitt als Benchmark

---

## ğŸ“ Zusammenfassung

**Feature:** Mitarbeiter-Info-Karte im Schichtplanung Tab  
**Version:** v4.12.4  
**Status:** âœ… **COMPLETE - PRODUCTION READY**  

**Changed Files:**
- âœ… `/components/BrowoKo_EmployeeInfoCard.tsx` (NEU)
- âœ… `/components/BrowoKo_ShiftPlanningTab.tsx` (Integration)

**Dependencies:**
- `work_sessions` Table (Zeiterfassung)
- `shifts` Table (Schichtplanung)
- `users` Table (Profil-Daten)
- `locations` Table (Standort-Namen)

**Lines of Code:** ~350 (neue Komponente)

---

**Letzte Aktualisierung:** v4.12.4  
**Autor:** Assistant  
**Type:** Feature - Employee Info Card
