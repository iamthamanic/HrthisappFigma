# ğŸ“ Browo Koordinator - Complete Learning System v4.13.0

## ğŸ“Š ÃœBERBLICK

Das komplette Lernsystem besteht aus 6 Hauptkomponenten:
1. **Videos** (âœ… vorhanden)
2. **Tests/Quizzes** (âœ… DB vorhanden, UI fehlt)
3. **Lerneinheiten** (âŒ fehlt komplett)
4. **Avatar/Gamification** (âš ï¸ teilweise vorhanden)
5. **Wiki** (âœ… vorhanden)
6. **YouTube Integration** (âŒ fehlt)

---

## âœ… WAS WIR BEREITS HABEN

### 1. Database Schema (Migration 055)
**Tabellen:**
- âœ… `tests` - Test-Vorlagen mit Settings
- âœ… `test_blocks` - 10 Block-Typen implementiert
- âœ… `test_video_assignments` - Videos mit Tests verknÃ¼pfen
- âœ… `test_attempts` - User-Versuche tracken
- âœ… `learning_units` VIEW - Automatische VerknÃ¼pfung

**Block-Typen (alle 10):**
```sql
MULTIPLE_CHOICE      âœ… 1 richtige Antwort
MULTIPLE_SELECT      âœ… Mehrere richtige Antworten
TRUE_FALSE          âœ… Richtig/Falsch
SHORT_TEXT          âœ… Kurze Textantwort
LONG_TEXT           âœ… Essay/Paragraph
FILL_BLANKS         âœ… LÃ¼ckentext
ORDERING            âœ… Reihenfolge sortieren
MATCHING            âœ… Zuordnen (Matching pairs)
SLIDER              âœ… Wert auf Skala wÃ¤hlen
FILE_UPLOAD         âœ… Datei hochladen
```

**Features:**
- âœ… Template System (Tests als Vorlagen speichern)
- âœ… Belohnungssystem (Coins pro Test)
- âœ… Attempt-Limiting (max. Versuche)
- âœ… Time Limits
- âœ… Pass Percentage
- âœ… Helper Functions (Statistics, Best Attempt, Can Attempt)

### 2. Frontend Components
**User Side:**
- âœ… `LearningScreen.tsx` - Hauptansicht mit Tabs (Videos, Pflicht, Skills, Wiki)
- âœ… `VideoCardWithProgress.tsx` - Video-Cards
- âœ… `QuizCard.tsx` - Quiz-Cards
- âœ… `QuizPlayer.tsx` - Quiz abspielen
- âœ… `BrowoKo_LearningAvatarWidget.tsx` - Avatar Widget
- âœ… `BrowoKo_LearningStatsGrid.tsx` - Stats anzeigen

**Admin Side:**
- âœ… `LearningManagementScreen.tsx` - Admin-Verwaltung mit Tabs (Videos, Tests, Units, Avatar, Wiki)
- âœ… Video CRUD (Create, Edit, Delete)
- âœ… Wiki CRUD komplett

### 3. Services & Stores
- âœ… `BrowoKo_learningService.ts` - API Calls
- âœ… `BrowoKo_learningStore.ts` - State Management
- âœ… `BrowoKo_wikiService.ts` - Wiki komplett

### 4. Avatar/Gamification System
- âœ… XP System vorhanden
- âœ… Coins System vorhanden
- âœ… Level System basic vorhanden
- âš ï¸ Items/Shop fehlt grÃ¶ÃŸtenteils

---

## âŒ WAS NOCH FEHLT

### 1. Test Builder UI (Admin)
**Komponenten zu erstellen:**
- `BrowoKo_TestBuilderDialog.tsx` - Haupt-Dialog
- `BrowoKo_TestBlockEditor.tsx` - Block-Editor fÃ¼r alle 10 Typen
- `BrowoKo_TestTemplateSelector.tsx` - Template auswÃ¤hlen
- `BrowoKo_TestsList.tsx` - Liste aller Tests
- `BrowoKo_TestCard.tsx` - Test-Card in Liste

**Features:**
- Drag & Drop fÃ¼r Block-Reihenfolge
- Live-Preview des Tests
- Template-System (Speichern/Laden)
- Test-Video-Assignment UI

### 2. Lerneinheiten System
**Was ist eine Lerneinheit?**
```
Lerneinheit = Video + Test + Belohnungen
```

**Zu erstellen:**
- `BrowoKo_LearningUnitBuilder.tsx` - Unit zusammenstellen
- `BrowoKo_LearningUnitCard.tsx` - Unit-Card fÃ¼r User
- `BrowoKo_LearningUnitProgress.tsx` - Fortschritt anzeigen
- Tab "Lerneinheiten" in `LearningScreen.tsx`
- Tab "Einheiten" in `LearningManagementScreen.tsx`

**Logik:**
```
1. User schaut Video
2. Video endet â†’ Test wird freigeschaltet
3. User macht Test
4. Test bestanden â†’ Belohnungen (XP, Coins, Items)
5. Lerneinheit = abgeschlossen âœ…
```

### 3. YouTube API Integration
**Zweck:**
- Automatisch Video-Daten von YouTube ziehen (Titel, Beschreibung, Duration, Thumbnail)
- Video-URL eingeben â†’ Daten automatisch laden

**Zu erstellen:**
- YouTube API Service
- Auto-Fill Feature in Video-Dialogen
- Environment Variable: `YOUTUBE_API_KEY`

**Dokumentation:**
- Siehe `/YOUTUBE_API_SETUP.md` (existiert bereits!)

### 4. Avatar System Erweiterung
**Fehlt:**
- Items-Verwaltung (Admin)
- Items-Daten-Modell (DB)
- Level-Thresholds definieren (Admin UI)
- Achievement-Items verknÃ¼pfen

**Zu erstellen:**
- `BrowoKo_ItemManager.tsx` - Items anlegen/bearbeiten
- `BrowoKo_LevelManager.tsx` - Level-System konfigurieren
- DB Migration fÃ¼r Items

### 5. Abteilungs-/Standort-/Spezialisierungs-Zuweisung
**Wo:**
- Videos
- Tests
- Lerneinheiten
- Wiki-Artikel (âœ… bereits vorhanden!)

**Zu erweitern:**
- Videos-Tabelle: `departments[]`, `locations[]`, `specializations[]`
- Tests-Tabelle: `departments[]`, `locations[]`, `specializations[]`
- UI: Multi-Select in Create/Edit Dialogen
- Filtering nach User-Profil (nur relevante Inhalte zeigen)

---

## ğŸ¯ IMPLEMENTIERUNGS-ROADMAP

### Phase 1: Test Builder Foundation (v4.13.1)
**Ziel:** Admins kÃ¶nnen Tests erstellen und mit Videos verknÃ¼pfen

**Tasks:**
1. âœ… DB Schema check (bereits vorhanden)
2. ğŸ”¨ Service Layer erweitern (`BrowoKo_learningService.ts`)
   - `createTest()`
   - `updateTest()`
   - `deleteTest()`
   - `getTests()`
   - `createTestBlock()`
   - `updateTestBlock()`
   - `deleteTestBlock()`
   - `assignTestToVideo()`
3. ğŸ”¨ Admin UI Components:
   - `BrowoKo_TestsList.tsx`
   - `BrowoKo_TestCard.tsx`
   - `BrowoKo_CreateTestDialog.tsx`
   - `BrowoKo_EditTestDialog.tsx`
4. ğŸ”¨ Tab "Tests" in `LearningManagementScreen.tsx` aktivieren
5. ğŸ”¨ Basic Test-Block-Editor (nur Multiple Choice erst mal)

**GeschÃ¤tzte Zeit:** 4-6 Stunden

---

### Phase 2: Test Block Types (v4.13.2)
**Ziel:** Alle 10 Block-Typen im Editor verfÃ¼gbar

**Tasks:**
1. ğŸ”¨ `BrowoKo_TestBlockEditor.tsx` - Haupt-Editor
2. ğŸ”¨ Block-Type Components:
   - `BrowoKo_MultipleChoiceBlock.tsx`
   - `BrowoKo_TrueFalseBlock.tsx`
   - `BrowoKo_TextInputBlock.tsx`
   - `BrowoKo_FillBlanksBlock.tsx`
   - `BrowoKo_OrderingBlock.tsx`
   - `BrowoKo_MatchingBlock.tsx`
   - `BrowoKo_SliderBlock.tsx`
   - `BrowoKo_FileUploadBlock.tsx`
3. ğŸ”¨ Drag & Drop fÃ¼r Block-Reihenfolge (react-dnd)
4. ğŸ”¨ Live-Preview des Tests

**GeschÃ¤tzte Zeit:** 6-8 Stunden

---

### Phase 3: Template System (v4.13.3)
**Ziel:** Tests als Templates speichern und wiederverwenden

**Tasks:**
1. ğŸ”¨ `BrowoKo_TestTemplateSelector.tsx`
2. ğŸ”¨ "Als Template speichern" Button
3. ğŸ”¨ "Aus Template erstellen" Button
4. ğŸ”¨ Template-Kategorien (Onboarding, Advanced, etc.)
5. ğŸ”¨ Template-Bibliothek UI

**GeschÃ¤tzte Zeit:** 2-3 Stunden

---

### Phase 4: Lerneinheiten System (v4.13.4)
**Ziel:** Videos + Tests = Lerneinheiten

**Tasks:**
1. ğŸ”¨ Tab "Lerneinheiten" in User `LearningScreen.tsx`
2. ğŸ”¨ Tab "Einheiten" in Admin `LearningManagementScreen.tsx`
3. ğŸ”¨ `BrowoKo_LearningUnitBuilder.tsx` (Admin)
4. ğŸ”¨ `BrowoKo_LearningUnitCard.tsx` (User)
5. ğŸ”¨ `BrowoKo_LearningUnitProgress.tsx` (User)
6. ğŸ”¨ Logik: Video Ende â†’ Test freischalten
7. ğŸ”¨ Logik: Test bestanden â†’ Belohnungen vergeben

**GeschÃ¤tzte Zeit:** 4-5 Stunden

---

### Phase 5: YouTube API Integration (v4.13.5)
**Ziel:** Video-Daten automatisch von YouTube laden

**Tasks:**
1. ğŸ”¨ YouTube API Service erstellen
2. ğŸ”¨ Environment Variable Setup
3. ğŸ”¨ Auto-Fill in `CreateVideoDialog.tsx`
4. ğŸ”¨ Auto-Fill in `EditVideoDialog.tsx`
5. ğŸ”¨ Thumbnail-Anzeige
6. ğŸ”¨ Duration-Parsing

**GeschÃ¤tzte Zeit:** 2-3 Stunden

---

### Phase 6: Avatar System Erweiterung (v4.13.6)
**Ziel:** Items, Levels, Achievements erweitern

**Tasks:**
1. ğŸ”¨ DB Migration: Items-Tabelle
2. ğŸ”¨ `BrowoKo_ItemManager.tsx` (Admin)
3. ğŸ”¨ `BrowoKo_LevelManager.tsx` (Admin)
4. ğŸ”¨ Level-Thresholds UI
5. ğŸ”¨ Item-Shop UI (User)
6. ğŸ”¨ Achievement-Items verknÃ¼pfen

**GeschÃ¤tzte Zeit:** 5-6 Stunden

---

### Phase 7: Content-Zuweisung (v4.13.7)
**Ziel:** Abteilungs-/Standort-/Spezialisierungs-Filter

**Tasks:**
1. ğŸ”¨ DB Migration: Spalten hinzufÃ¼gen
2. ğŸ”¨ Multi-Select in Video-Dialogen
3. ğŸ”¨ Multi-Select in Test-Dialogen
4. ğŸ”¨ Multi-Select in Lerneinheiten-Builder
5. ğŸ”¨ User-Profil-basierte Filter-Logik
6. ğŸ”¨ "FÃ¼r mich relevante Inhalte" Toggle

**GeschÃ¤tzte Zeit:** 3-4 Stunden

---

## ğŸ“ DATENMODELL-ERWEITERUNGEN

### Videos Tabelle erweitern
```sql
ALTER TABLE videos ADD COLUMN IF NOT EXISTS departments UUID[];
ALTER TABLE videos ADD COLUMN IF NOT EXISTS locations UUID[];
ALTER TABLE videos ADD COLUMN IF NOT EXISTS specializations TEXT[];
```

### Items Tabelle (neu)
```sql
CREATE TABLE avatar_items (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  name TEXT NOT NULL,
  description TEXT,
  icon TEXT, -- Icon name or emoji
  type TEXT NOT NULL, -- 'AVATAR_ACCESSORY', 'BADGE', 'TITLE', 'EMOTE'
  rarity TEXT NOT NULL DEFAULT 'COMMON', -- 'COMMON', 'RARE', 'EPIC', 'LEGENDARY'
  price_coins INTEGER NOT NULL DEFAULT 0,
  price_xp INTEGER NOT NULL DEFAULT 0,
  level_required INTEGER NOT NULL DEFAULT 1,
  is_purchasable BOOLEAN NOT NULL DEFAULT true,
  is_achievement_reward BOOLEAN NOT NULL DEFAULT false,
  achievement_id UUID REFERENCES coin_achievements(id),
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
```

### Level Thresholds Tabelle (neu)
```sql
CREATE TABLE level_thresholds (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  organization_id UUID NOT NULL REFERENCES organizations(id),
  level INTEGER NOT NULL,
  xp_required INTEGER NOT NULL,
  title TEXT, -- "AnfÃ¤nger", "Experte", "Meister"
  icon TEXT,
  rewards_coins INTEGER NOT NULL DEFAULT 0,
  rewards_items UUID[], -- Array of avatar_items IDs
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  UNIQUE(organization_id, level)
);
```

---

## ğŸ¨ UI/UX KONZEPT

### User Lernzentrum Tabs
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lernzentrum                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Alle] [Videos] [Lerneinheiten] [Pflicht] [Skills] [Wiki] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tab "Lerneinheiten":
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Onboarding Basics            â”‚
â”‚ â”œâ”€ ğŸ“¹ Willkommen Video (5 Min)  â”‚
â”‚ â”œâ”€ âœ… Test: 5 Fragen            â”‚
â”‚ â””â”€ ğŸ Belohnung: 50 XP, 10 Coinsâ”‚
â”‚ â–¶ï¸ STARTEN                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ Sicherheitsschulung          â”‚
â”‚ â”œâ”€ ğŸ“¹ Sicherheit Video (12 Min) â”‚
â”‚ â”œâ”€ âœ… Test: 10 Fragen           â”‚
â”‚ â””â”€ ğŸ Belohnung: 100 XP, 25 Coinsâ”‚
â”‚ âœ… ABGESCHLOSSEN (95%)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Admin Test Builder
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Test erstellen                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Titel: [_____________________]          â”‚
â”‚ Beschreibung: [____________]            â”‚
â”‚ Pass Percentage: [80%]                  â”‚
â”‚ Max. Versuche: [3]                      â”‚
â”‚ Zeitlimit: [30] Minuten                 â”‚
â”‚ Belohnung: [50] Coins                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BlÃ¶cke:                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ â”‚ ğŸ¯ Multiple Choice          â”‚         â”‚
â”‚ â”‚ Frage: "Was ist HR?"        â”‚         â”‚
â”‚ â”‚ â˜‘ Human Resources           â”‚         â”‚
â”‚ â”‚ â˜ Human Robots              â”‚         â”‚
â”‚ â”‚ [10 Punkte] [Pflicht âœ“]    â”‚         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                         â”‚
â”‚ [+ Block hinzufÃ¼gen â–¼]                  â”‚
â”‚   â”œâ”€ Multiple Choice                    â”‚
â”‚   â”œâ”€ True/False                         â”‚
â”‚   â”œâ”€ Text Input                         â”‚
â”‚   â”œâ”€ ...                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Als Template speichern]  [Speichern]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ BELOHNUNGS-LOGIK

### Lerneinheit abgeschlossen
```javascript
async function completeLearningUnit(userId, unitId) {
  // 1. Video geschaut?
  const videoProgress = await getVideoProgress(userId, unitId.videoId);
  if (videoProgress < 100) return { error: "Video nicht abgeschlossen" };
  
  // 2. Test bestanden?
  const testAttempt = await getBestTestAttempt(userId, unitId.testId);
  if (!testAttempt.passed) return { error: "Test nicht bestanden" };
  
  // 3. Belohnungen vergeben
  const rewards = await grantRewards(userId, {
    xp: unitId.xpReward,
    coins: unitId.coinReward,
    items: unitId.itemRewards
  });
  
  // 4. Level-Up Check
  await checkLevelUp(userId);
  
  // 5. Achievement-Trigger
  await triggerAchievements(userId, 'LEARNING_UNIT_COMPLETED');
  
  return { success: true, rewards };
}
```

---

## ğŸš€ PRIORISIERUNG

### User mÃ¶chte wissen: **Was zuerst?**

**Meine Empfehlung - 3 Wege:**

### ğŸƒ Weg 1: Schnell & MVP (2-3 Tage)
```
1. Phase 1: Test Builder Foundation (Simple UI)
2. Phase 4: Lerneinheiten Basic (Video + Test verknÃ¼pfen)
3. Phase 5: YouTube API (Auto-Fill)
â†’ User kÃ¶nnen sofort Lerneinheiten machen!
```

### ğŸ¯ Weg 2: Komplett & Professionell (5-7 Tage)
```
1. Alle 7 Phasen nacheinander
2. Alle Features vollstÃ¤ndig
3. Avatar System komplett
4. Content-Zuweisung Ã¼berall
â†’ Production-ready Full-Feature System!
```

### âš¡ Weg 3: Hybrid (3-4 Tage)
```
1. Phase 1: Test Builder Foundation
2. Phase 2: Nur 5 wichtigste Block-Typen
3. Phase 3: Template System
4. Phase 4: Lerneinheiten
5. Phase 5: YouTube API
â†’ SpÃ¤ter: Phase 6 + 7 (Avatar + Zuweisung)
```

---

## â“ OFFENE FRAGEN AN DICH

1. **Welchen Weg willst du gehen?** (Schnell, Komplett, Hybrid)

2. **Welche Block-Typen sind am wichtigsten?**
   - Multiple Choice â† immer wichtig
   - True/False â† einfach
   - Text Input â† flexibel
   - File Upload â† komplex
   - ...

3. **YouTube API:**
   - Hast du schon einen API Key?
   - Siehe: `/YOUTUBE_API_SETUP.md`

4. **Avatar Items:**
   - Sollen User Items kaufen kÃ¶nnen?
   - Oder nur durch Achievements bekommen?

5. **Content-Zuweisung:**
   - Manuell von Admin festlegen?
   - Oder automatisch basierend auf User-Profil?

6. **Lerneinheiten:**
   - Zwingend Video + Test?
   - Oder auch nur Video? Oder nur Test?

---

## ğŸ“ NÃ„CHSTE SCHRITTE

**Sage mir einfach:**
- Welcher Weg? (Schnell / Komplett / Hybrid)
- Oder: "Fang mit Phase 1 an!"

Dann legen wir sofort los! ğŸš€
